#'
#' KMeans Model in H2O
#'
#' Performs k-means clustering on an H2O dataset.
#'
#'
#' @param training_frame An \linkS4class{H2OFrame} object containing the
#'        variables in the model.
#' @param x (Optional) A vector containing the data columns on
#'        which k-means operates.
#' @param k The number of clusters. Must be between 1 and
#'        1e7 inclusive. k may be omitted if the user specifies the
#'        initial centers in the init parameter. If k is not omitted,
#'        in this case, then it should be equal to the number of
#'        user-specified centers.
#' @param destination_key (Optional) The unique hex key assigned to the
#'        resulting model. Automatically generated if none is provided.
#' @param max_iters The maximum number of iterations allowed. Must be between 0
#         and 1e6 inclusive.
#' @param standardize Logical, indicates whether the data should be
#'        standardized before running k-means.
#' @param init A character string that selects the initial set of k cluster
#'        centers. Possible values are "Random": for random initialization,
#'        "PlusPlus": for k-means plus initialization, or "Furthest": for
#'        initialization at the furthest point from each successive center.
#'        Additionally, the user may specify a the initial centers as a
#'        matrix, data.frame, H2OFrame, or list of vectors. For matrices,
#'        data.frames, and H2OFrames, each row of the respective structure
#'        is an initial center. For lists of vectors, each vector is an
#'        initial center.
#' @param seed (Optional) Random seed used to initialize the cluster centroids.
#' @return Returns an object of class \linkS4class{H2OKMeansModel}.
#' @examples
#' library(h2o)
#' localH2O <- h2o.init()
#' prosPath <- system.file("extdata", "prostate.csv", package="h2o")
#' prostate.hex <- h2o.uploadFile(localH2O, path = prosPath)
#' h2o.kmeans(training_frame = prostate.hex, k = 10, x = c("AGE", "RACE", "VOL", "GLEASON"))
h2o.kmeans <- function(training_frame, x, k,
                       ## AUTOGENERATED PARAMETERS ##     #these defaults are not read by h2o
                       destination_key,                   #h2o generates its own default parameters
                       max_iters = 1000,
                       standardize = TRUE,
                       init = c("Furthest","Random", "PlusPlus"),
                       seed)
{
  # Required args: training_frame
  if( missing(training_frame) ) stop ("argument \"training_frame\" is missing, with no default")

  # Gather user input
  parms <- as.list(match.call()[-1L])
  names(parms) <- lapply(names(parms), function(i) { if( i %in% names(.kmeans.map) ) i <- .kmeans.map[[i]]; i })

  if( !(missing(x)) ) parms[["ignored_columns"]] <- .verify_datacols(training_frame, x)$cols_ignore

  # Check if init is an acceptable set of user-specified starting points
  if( is.data.frame(init) || is.matrix(init) || is.list(init) || inherits(init, "H2OFrame") ) {
    parms[["init"]] <- "User"
    # Convert user-specified starting points to H2OFrame
    if( is.data.frame(init) || is.matrix(init) || is.list(init) ) {
        if( !is.data.frame(init) && !is.matrix(init) ) init <- t(as.data.frame(init))
        parms[["user_points"]] <- as.h2o(training_frame@h2o, init)
    }
    else {
        parms[["user_points"]] <- init
    }
    # Set k
    if( !(missing(k)) && k!=as.integer(nrow(init)) ) {
        print("Warning: Parameter k is not equal to the number of user-specified starting points. Ignoring k. Using specified starting points.")
    }
    parms[["user_points"]] <- parms[["user_points"]]@key
    parms[["k"]] <- as.integer(nrow(init))
  }
  else if ( is.character(init) ) { # Furthest, Random, PlusPlus
    parms[["user_points"]] <- NULL
  }
  else{
    stop ("argument init must be set to Furthest, Random, PlusPlus, or a valid set of user-defined starting points.")
  }

  # Error check and build model
  .run(training_frame@h2o, 'kmeans', parms, parent.frame())

}

.kmeans.map <- c("x" = "ignored_columns")
